/**
 * Hilo 1.1.7 for commonjs
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
var Class=require("../core/Class"),Tween=function(){function e(){return+new Date}return Class.create({constructor:function(e,t,r,n){var a=this;a.target=e,a._startTime=0,a._seekTime=0,a._pausedTime=0,a._pausedStartTime=0,a._reverseFlag=1,a._repeatCount=0,3==arguments.length&&(n=r,r=t,t=null);for(var s in n)a[s]=n[s];a._fromProps=t,a._toProps=r,!n.duration&&n.time&&(a.duration=n.time||0,a.time=0)},target:null,duration:1e3,delay:0,paused:!1,loop:!1,reverse:!1,repeat:0,repeatDelay:0,ease:null,time:0,isStart:!1,onStart:null,onUpdate:null,onComplete:null,setProps:function(e,t){var r=this,n=r.target,a=e||t,s=r._fromProps={},i=r._toProps={};e=e||n,t=t||n;for(var o in a)i[o]=t[o]||0,n[o]=s[o]=e[o]||0;return r},start:function(){var t=this;return t._startTime=e()+t.delay,t._seekTime=0,t._pausedTime=0,t.paused=!1,Tween.add(t),t},stop:function(){return Tween.remove(this),this},pause:function(){var t=this;return t.paused=!0,t._pausedStartTime=e(),t},resume:function(){var t=this;return t.paused=!1,t._pausedStartTime&&(t._pausedTime+=e()-t._pausedStartTime),t._pausedStartTime=0,t},seek:function(t,r){var n=this,a=e();return n._startTime=a,n._seekTime=t,n._pausedTime=0,void 0!==r&&(n.paused=r),n._update(a,!0),Tween.add(n),n},link:function(e){var t,r,n=this,a=e.delay,s=n._startTime;return"string"==typeof a&&(t=0==a.indexOf("+"),r=0==a.indexOf("-"),a=t||r?Number(a.substr(1))*(t?1:-1):Number(a)),e.delay=a,e._startTime=t||r?s+n.duration+a:s+a,n._next=e,Tween.remove(e),e},_render:function(e){var t,r=this,n=r.target,a=r._fromProps;for(t in a)n[t]=a[t]+(r._toProps[t]-a[t])*e},_update:function(t,r){var n=this;if(!n.paused||r){var a=t-n._startTime-n._pausedTime+n._seekTime;if(!(a<0)){var s,i=a/n.duration,o=!1;i=i<=0?0:i>=1?1:i;var u=n.ease?n.ease(i):i;n.reverse&&(n._reverseFlag<0&&(i=1-i,u=1-u),i<1e-7&&(n.repeat>0&&n._repeatCount++>=n.repeat||0==n.repeat&&!n.loop?o=!0:(n._startTime=e(),n._pausedTime=0,n._reverseFlag*=-1))),n.isStart||(n.setProps(n._fromProps,n._toProps),n.isStart=!0,n.onStart&&n.onStart.call(n,n)),n.time=a,n._render(u),(s=n.onUpdate)&&s.call(n,i,n),i>=1&&(n.reverse?(n._startTime=e(),n._pausedTime=0,n._reverseFlag*=-1):n.loop||n.repeat>0&&n._repeatCount++<n.repeat?(n._startTime=e()+n.repeatDelay,n._pausedTime=0):o=!0);var p=n._next;if(p&&p.time<=0){var l=p._startTime;l>0&&l<=t?(p._render(i),p.time=a,Tween.add(p)):o&&(l<0||l>t)&&p.start()}return o?((s=n.onComplete)&&s.call(n,n),!0):void 0}}},Statics:{_tweens:[],tick:function(){var t,r,n=Tween._tweens,a=n.length;for(r=0;r<a;r++)t=n[r],t&&t._update(e())&&(n.splice(r,1),r--);return Tween},add:function(e){var t=Tween._tweens;return t.indexOf(e)==-1&&t.push(e),Tween},remove:function(e){var t,r;if(e instanceof Array){for(t=0,r=e.length;t<r;t++)Tween.remove(e[t]);return Tween}var n=Tween._tweens;if(e instanceof Tween)t=n.indexOf(e),t>-1&&n.splice(t,1);else for(t=0;t<n.length;t++)n[t].target===e&&(n.splice(t,1),t--);return Tween},removeAll:function(){return Tween._tweens.length=0,Tween},fromTo:function(e,t,r,n){n=n||{};var a=e instanceof Array;e=a?e:[e];var s,i,o=n.stagger,u=[];for(i=0;i<e.length;i++)s=new Tween(e[i],t,r,n),o&&(s.delay=(n.delay||0)+(i*o||0)),s.start(),u.push(s);return a?u:s},to:function(e,t,r){return Tween.fromTo(e,null,t,r)},from:function(e,t,r){return Tween.fromTo(e,t,null,r)}}})}();module.exports=Tween;