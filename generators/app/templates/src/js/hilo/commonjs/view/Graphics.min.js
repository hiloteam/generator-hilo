/**
 * Hilo 1.1.7 for commonjs
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
var Hilo=require("../core/Hilo"),Class=require("../core/Class"),View=require("./View"),CacheMixin=require("./CacheMixin"),Graphics=function(){var t=document.createElement("canvas"),e=t.getContext&&t.getContext("2d");return Class.create({Extends:View,Mixes:CacheMixin,constructor:function(t){t=t||{},this.id=this.id||t.id||Hilo.getUid("Graphics"),Graphics.superclass.constructor.call(this,t),this._actions=[]},lineWidth:1,lineAlpha:1,lineCap:null,lineJoin:null,miterLimit:10,hasStroke:!1,strokeStyle:"0",hasFill:!1,fillStyle:"0",fillAlpha:0,lineStyle:function(t,e,i,l,r,n){var a=this,o=a._addAction;return o.call(a,["lineWidth",a.lineWidth=t||1]),o.call(a,["strokeStyle",a.strokeStyle=e||"0"]),o.call(a,["lineAlpha",a.lineAlpha=i||1]),void 0!=l&&o.call(a,["lineCap",a.lineCap=l]),void 0!=r&&o.call(a,["lineJoin",a.lineJoin=r]),void 0!=n&&o.call(a,["miterLimit",a.miterLimit=n]),a.hasStroke=!0,a},beginFill:function(t,e){var i=this,l=i._addAction;return l.call(i,["fillStyle",i.fillStyle=t]),l.call(i,["fillAlpha",i.fillAlpha=e||1]),i.hasFill=!0,i},endFill:function(){var t=this,e=t._addAction;return t.hasStroke&&e.call(t,["stroke"]),t.hasFill&&e.call(t,["fill"]),t.setCacheDirty(!0),t},beginLinearGradientFill:function(t,i,l,r,n,a){for(var o=this,c=e.createLinearGradient(t,i,l,r),s=0,h=n.length;s<h;s++)c.addColorStop(a[s],n[s]);return o.hasFill=!0,o._addAction(["fillStyle",o.fillStyle=c])},beginRadialGradientFill:function(t,i,l,r,n,a,o,c){for(var s=this,h=e.createRadialGradient(t,i,l,r,n,a),u=0,d=o.length;u<d;u++)h.addColorStop(c[u],o[u]);return s.hasFill=!0,s._addAction(["fillStyle",s.fillStyle=h])},beginBitmapFill:function(t,i){var l=this,r=e.createPattern(t,i||"");return l.hasFill=!0,l._addAction(["fillStyle",l.fillStyle=r])},beginPath:function(){return this._addAction(["beginPath"])},closePath:function(){return this._addAction(["closePath"])},moveTo:function(t,e){return this._addAction(["moveTo",t,e])},lineTo:function(t,e){return this._addAction(["lineTo",t,e])},quadraticCurveTo:function(t,e,i,l){return this._addAction(["quadraticCurveTo",t,e,i,l])},bezierCurveTo:function(t,e,i,l,r,n){return this._addAction(["bezierCurveTo",t,e,i,l,r,n])},drawRect:function(t,e,i,l){return this._addAction(["rect",t,e,i,l])},drawRoundRectComplex:function(t,e,i,l,r,n,a,o){var c=this,s=c._addAction;return s.call(c,["moveTo",t+r,e]),s.call(c,["lineTo",t+i-n,e]),s.call(c,["arc",t+i-n,e+n,n,-Math.PI/2,0,!1]),s.call(c,["lineTo",t+i,e+l-a]),s.call(c,["arc",t+i-a,e+l-a,a,0,Math.PI/2,!1]),s.call(c,["lineTo",t+o,e+l]),s.call(c,["arc",t+o,e+l-o,o,Math.PI/2,Math.PI,!1]),s.call(c,["lineTo",t,e+r]),s.call(c,["arc",t+r,e+r,r,Math.PI,3*Math.PI/2,!1]),c},drawRoundRect:function(t,e,i,l,r){return this.drawRoundRectComplex(t,e,i,l,r,r,r,r)},drawCircle:function(t,e,i){return this._addAction(["arc",t+i,e+i,i,0,2*Math.PI,0])},drawEllipse:function(t,e,i,l){var r=this;if(i==l)return r.drawCircle(t,e,i);var n=r._addAction,a=i/2,o=l/2,c=.5522847498307933,s=c*a,h=c*o;return t+=a,e+=o,n.call(r,["moveTo",t+a,e]),n.call(r,["bezierCurveTo",t+a,e-h,t+s,e-o,t,e-o]),n.call(r,["bezierCurveTo",t-s,e-o,t-a,e-h,t-a,e]),n.call(r,["bezierCurveTo",t-a,e+h,t-s,e+o,t,e+o]),n.call(r,["bezierCurveTo",t+s,e+o,t+a,e+h,t+a,e]),r},drawSVGPath:function(t){var e=this,i=e._addAction,l=t.replace(/,/g," ").replace(/-/g," -").split(/(?=[a-zA-Z])/);i.call(e,["beginPath"]);for(var r,n={x:0,y:0},a={x:0,y:0},o=0,c=l.length;o<c;o++){var s=l[o];if(s.length){var h=s[0],u=h.toUpperCase(),d=this._getSVGParams(s),f=u!==h;switch(u){case"M":f&&this._convertToAbsolute(n,d),i.call(e,["moveTo",d[0],d[1]]),this._setCurrentPoint(n,d[0],d[1]);break;case"L":f&&this._convertToAbsolute(n,d),i.call(e,["lineTo",d[0],d[1]]),this._setCurrentPoint(n,d[0],d[1]);break;case"H":f&&(d[0]+=n.x),i.call(e,["lineTo",d[0],n.y]),n.x=d[0];break;case"V":f&&(d[0]+=n.y),i.call(e,["lineTo",n.x,d[0]]),n.y=d[0];break;case"Z":i.call(e,["closePath"]);break;case"C":f&&this._convertToAbsolute(n,d),i.call(e,["bezierCurveTo",d[0],d[1],d[2],d[3],d[4],d[5]]),a.x=d[2],a.y=d[3],this._setCurrentPoint(n,d[4],d[5]);break;case"S":f&&this._convertToAbsolute(n,d),v="C"===r||"S"===r?this._getReflectionPoint(n,a):n,i.call(e,["bezierCurveTo",v.x,v.y,d[0],d[1],d[2],d[3]]),a.x=d[0],a.y=d[1],this._setCurrentPoint(n,d[2],d[3]);break;case"Q":f&&this._convertToAbsolute(n,d),i.call(e,["quadraticCurveTo",d[0],d[1],d[2],d[3]]),a.x=d[0],a.y=d[1],this._setCurrentPoint(n,d[2],d[3]);break;case"T":f&&this._convertToAbsolute(n,d);var v;v="Q"===r||"T"===r?this._getReflectionPoint(n,a):n,i.call(e,["quadraticCurveTo",v.x,v.y,d[0],d[1]]),a=v,this._setCurrentPoint(n,d[0],d[1])}r=u}}return e},_getSVGParams:function(t){var e=t.substring(1).replace(/[\s]+$|^[\s]+/g,"").split(/[\s]+/);0==e[0].length&&e.shift();for(var i=0,l=e.length;i<l;i++)e[i]=parseFloat(e[i]);return e},_convertToAbsolute:function(t,e){for(var i=0,l=e.length;i<l;i++)i%2===0?e[i]+=t.x:e[i]+=t.y},_setCurrentPoint:function(t,e,i){t.x=e,t.y=i},_getReflectionPoint:function(t,e){return{x:2*t.x-e.x,y:2*t.y-e.y}},_draw:function(t){var e,i=this,l=i._actions,r=l.length;for(t.beginPath(),e=0;e<r;e++){var n=l[e],a=n[0],o=n.length>1?n.slice(1):null;"function"==typeof t[a]?t[a].apply(t,o):t[a]=n[1]}},render:function(t,e){var i=this;"canvas"===t.renderType?i._draw(t.context):(i.cache(),t.draw(i))},clear:function(){var t=this;return t._actions.length=0,t.lineWidth=1,t.lineAlpha=1,t.lineCap=null,t.lineJoin=null,t.miterLimit=10,t.hasStroke=!1,t.strokeStyle="0",t.hasFill=!1,t.fillStyle="0",t.fillAlpha=1,t.setCacheDirty(!0),t},_addAction:function(t){var e=this;return e._actions.push(t),e}})}();module.exports=Graphics;