/**
 * Hilo 1.1.10 for commonjs
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
var Hilo=require("../core/Hilo"),drag={_isDragStart:!1,dragNeedTransform:!1,startDrag:function(t){function e(t){t.stopPropagation(),n(t),i.off(Hilo.event.POINTER_START,e),T.x=i.x,T.y=i.y,i.dragNeedTransform&&i.parent&&i.parent.getConcatenatedMatrix().transformPoint(T),i.__dragX=T.x-d.x,i.__dragY=T.y-d.y,g||(g=i.getStage()),g.on(Hilo.event.POINTER_MOVE,a),document.addEventListener(Hilo.event.POINTER_END,r),i.fire("dragStart",d)}function r(t){document.removeEventListener(Hilo.event.POINTER_END,r),g&&g.off(Hilo.event.POINTER_MOVE,a),i.on(Hilo.event.POINTER_START,e),i.fire("dragEnd",d)}function a(t){n(t),T.x=d.x+i.__dragX,T.y=d.y+i.__dragY,i.dragNeedTransform&&i.parent&&i.parent.getConcatenatedMatrix().invert().transformPoint(T),i.x=Math.max(f,Math.min(_,T.x)),i.y=Math.max(s,Math.min(v,T.y)),i.fire("dragMove",d)}function n(t){d.preX=d.x,d.preY=d.y,d.x=t.stageX,d.y=t.stageY}function o(){i._isDragStart=!1,document.removeEventListener(Hilo.event.POINTER_END,r),g&&g.off(Hilo.event.POINTER_MOVE,a),i.off(Hilo.event.POINTER_START,e)}var i=this;i._isDragStart&&i.stopDrag(),i._isDragStart=!0;var g;t=t||[-(1/0),-(1/0),1/0,1/0];var d={x:0,y:0,preX:0,preY:0},f=t[0],s=t[1],_=t[2]==1/0?1/0:f+t[2],v=t[3]==1/0?1/0:s+t[3],T={x:0,y:0};i.on(Hilo.event.POINTER_START,e),i.stopDrag=o},stopDrag:function(){this._isDragStart=!1}};module.exports=drag;