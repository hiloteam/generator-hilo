/**
 * Hilo 1.0.0 for amd
 * Copyright 2015 alibaba.com
 * Licensed under the MIT License
 */
define("hilo/loader/LoadQueue",["hilo/core/Class","hilo/event/EventMixin","hilo/loader/ImageLoader","hilo/loader/ScriptLoader"],function(e,o,n,r){function t(e){var o,n,r=/\/?[^\/]+\.(\w+)(\?\S+)?$/i;return(o=e.match(r))&&(n=o[1].toLowerCase()),n||null}var a=e.create({Mixes:o,constructor:function(e){this._source=[],this.add(e)},maxConnections:2,_source:null,_loaded:0,_connections:0,_currentIndex:-1,add:function(e){var o=this;return e&&(e=e instanceof Array?e:[e],o._source=o._source.concat(e)),o},get:function(e){if(e)for(var o=this._source,n=0;n<o.length;n++){var r=o[n];if(r.id===e||r.src===e)return r}return null},getContent:function(e){var o=this.get(e);return o&&o.content},start:function(){var e=this;return e._loadNext(),e},_loadNext:function(){var e=this,o=e._source,n=o.length;if(e._loaded>=n)return void e.fire("complete");if(e._currentIndex<n-1&&e._connections<e.maxConnections){var r=++e._currentIndex,t=o[r],a=e._getLoader(t);if(a){var c=a.onLoad,i=a.onError;a.onLoad=function(o){a.onLoad=c,a.onError=i;var n=c&&c.call(a,o)||o.target;e._onItemLoad(r,n)},a.onError=function(o){a.onLoad=c,a.onError=i,i&&i.call(a,o),e._onItemError(r,o)},e._connections++}e._loadNext(),a&&a.load(t)}},_getLoader:function(e){var o=e.loader;if(o)return o;var a=e.type||t(e.src);switch(a){case"png":case"jpg":case"jpeg":case"gif":o=new n;break;case"js":case"jsonp":o=new r}return o},_onItemLoad:function(e,o){var n=this,r=n._source[e];r.loaded=!0,r.content=o,n._connections--,n._loaded++,n.fire("load",r),n._loadNext()},_onItemError:function(e,o){var n=this,r=n._source[e];r.error=o,n._connections--,n._loaded++,n.fire("error",r),n._loadNext()},getSize:function(e){for(var o=0,n=this._source,r=0;r<n.length;r++){var t=n[r];o+=(e?t.loaded&&t.size:t.size)||0}return o},getLoaded:function(){return this._loaded},getTotal:function(){return this._source.length}});return a});